
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" />
    <title>CactusTool.Lib.pygwanalysis.DataAnalysis &#8212; CactusTool 0.0.1 documentation</title>
    <link rel="stylesheet" href="../../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <script type="text/javascript" src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">CactusTool 0.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for CactusTool.Lib.pygwanalysis.DataAnalysis</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python</span>

<span class="c1">#----------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Routines and algorithms for GW data analysis.</span>
<span class="c1"># </span>
<span class="c1"># Released under the MIT Licence.</span>
<span class="c1"># (C) Christian Reisswig 2009-2011</span>
<span class="c1"># </span>
<span class="c1">#----------------------------------------------------</span>


<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">from</span> <span class="nn">.DiscreteFunction</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.WaveFunction</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.harmonics</span> <span class="k">import</span> <span class="o">*</span>

<span class="n">constant_c</span> <span class="o">=</span> <span class="mi">299792458</span>       <span class="c1"># speed of light in [m/sec]</span>
<span class="n">constant_G</span> <span class="o">=</span> <span class="mf">6.67428</span> <span class="o">*</span> <span class="mf">1e-11</span> <span class="c1"># gravitational constant in [m^3 kg^-1 s^-2]</span>
<span class="n">constant_H0</span> <span class="o">=</span> <span class="mf">70.0</span>         <span class="c1"># Hubble constant</span>

<span class="n">Msol</span> <span class="o">=</span> <span class="mf">1.9891</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">30</span>                                <span class="c1"># solar mass[kg]</span>
<span class="n">ConversionFac</span> <span class="o">=</span> <span class="n">constant_G</span><span class="o">/</span><span class="n">constant_c</span><span class="o">**</span><span class="mi">2</span>            <span class="c1"># [m/kg] (mass faktor G/c^2 to transform from geometrized units to SI units)</span>
<span class="n">Msec</span> <span class="o">=</span> <span class="n">Msol</span><span class="o">*</span><span class="n">ConversionFac</span><span class="o">/</span><span class="n">constant_c</span>                <span class="c1">#  one solar mass in [sec]</span>
<span class="n">Mm</span> <span class="o">=</span> <span class="n">Msol</span><span class="o">*</span><span class="n">ConversionFac</span>                             <span class="c1">#  one solar mass in[m]</span>
<span class="n">MmMsec</span> <span class="o">=</span> <span class="n">Msec</span> <span class="o">*</span> <span class="n">Mm</span>
<span class="n">Mpc</span> <span class="o">=</span> <span class="mf">3.08568025</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">16</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="mi">6</span>    <span class="c1"># 1 Mpc in[m] (~3.26 *10^6 ly)</span>

<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;/&quot;</span>
<span class="c1">#path = &quot;/home/reisswig/scripts/DataAnalysis/&quot;</span>

<span class="n">AdLIGOcurve</span> <span class="o">=</span> <span class="n">DiscreteFunction</span><span class="p">([],[])</span>
<span class="n">AdLIGOcurve</span><span class="o">.</span><span class="n">Load</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;AdLIGO_ZERO_DET_high_P.dat&quot;</span><span class="p">)</span>

<span class="n">eLIGOcurve</span> <span class="o">=</span> <span class="n">DiscreteFunction</span><span class="p">([],[])</span>
<span class="n">eLIGOcurve</span><span class="o">.</span><span class="n">Load</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;eligo.dat&quot;</span><span class="p">)</span>

<span class="n">AdVirgocurve</span> <span class="o">=</span> <span class="n">DiscreteFunction</span><span class="p">([],[])</span>
<span class="n">AdVirgocurve</span><span class="o">.</span><span class="n">Load</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;AdVrefsens.dat&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="FStrainToSI"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.FStrainToSI">[docs]</a><span class="k">def</span> <span class="nf">FStrainToSI</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts the Fourier domain strain to SI units&quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">Msec</span><span class="p">),</span> <span class="n">h</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="n">M</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">MmMsec</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="StrainToSI"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.StrainToSI">[docs]</a><span class="k">def</span> <span class="nf">StrainToSI</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Converts time domain strain to SI units&quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">M</span><span class="o">*</span><span class="n">Msec</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="n">Mm</span><span class="o">*</span><span class="n">M</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="StrainToCGS"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.StrainToCGS">[docs]</a><span class="k">def</span> <span class="nf">StrainToCGS</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Converts time domain strain to CGS units&quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">M</span><span class="o">*</span><span class="n">Msec</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="mf">1.4772e5</span><span class="o">*</span><span class="n">M</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="Psi4ToSI"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.Psi4ToSI">[docs]</a><span class="k">def</span> <span class="nf">Psi4ToSI</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Converts time domain psi4 to SI units&quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">M</span><span class="o">*</span><span class="n">Msec</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="n">Mm</span><span class="o">*</span><span class="n">M</span> <span class="o">/</span> <span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">Msec</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="NewsToSI"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.NewsToSI">[docs]</a><span class="k">def</span> <span class="nf">NewsToSI</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Converts time domain news to SI units&quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">M</span><span class="o">*</span><span class="n">Msec</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="n">Mm</span><span class="o">*</span><span class="n">M</span> <span class="o">/</span> <span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">Msec</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="TimesToSI"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.TimesToSI">[docs]</a><span class="k">def</span> <span class="nf">TimesToSI</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts a list of time values to SI units&quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">M</span> <span class="o">*</span> <span class="n">Msec</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="FrequenciesToSI"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.FrequenciesToSI">[docs]</a><span class="k">def</span> <span class="nf">FrequenciesToSI</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts a list of frequencies to SI units&quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">Msec</span><span class="p">),</span> <span class="n">f</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="SelecthPlus"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.SelecthPlus">[docs]</a><span class="k">def</span> <span class="nf">SelecthPlus</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a complex function h=h_+-ih_x, this returns h_+&quot;&quot;&quot;</span>
    <span class="n">hplus</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hplus</span></div>

<div class="viewcode-block" id="SelecthCross"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.SelecthCross">[docs]</a><span class="k">def</span> <span class="nf">SelecthCross</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a complex function h=h_+-ih_x, this returns h_x&quot;&quot;&quot;</span>
    <span class="n">hcross</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">h</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hcross</span></div>

<div class="viewcode-block" id="MinMassFromOmega"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.MinMassFromOmega">[docs]</a><span class="k">def</span> <span class="nf">MinMassFromOmega</span><span class="p">(</span><span class="n">omega</span><span class="p">,</span> <span class="n">fcut</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a frequency omega=2*pi*f in units 1/M and a lower detector sensitivity cut-off fcut [Hz], </span>
<span class="sd">       this computes the minimum allowable mass such that fSI&gt;=fcut, where fSI is f in SI units.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">omega</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fcut</span><span class="o">*</span><span class="n">Msec</span><span class="p">)</span></div>

<div class="viewcode-block" id="GaussSmooth"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.GaussSmooth">[docs]</a><span class="k">def</span> <span class="nf">GaussSmooth</span><span class="p">(</span><span class="n">WF</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Smoothes the input by convolving with a normal distribution&quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">WF</span><span class="o">.</span><span class="n">f</span><span class="o">*</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">Gauss</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">sigma0</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sigma</span><span class="p">)</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma0</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="c1">#WF.dx = WF.x[1]-WF.[0]</span>
    <span class="n">nkernel_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">sigma</span> <span class="o">/</span> <span class="n">WF</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">WF</span><span class="o">.</span><span class="n">dx</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">nkernel_points</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nkernel_points</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
        <span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">dx</span><span class="o">*</span><span class="n">nkernel_points</span> <span class="o">+</span> <span class="n">ii</span><span class="o">*</span><span class="n">dx</span>
    <span class="n">G</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Gauss</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nkernel_points</span><span class="p">,</span> <span class="n">WF</span><span class="o">.</span><span class="n">Length</span><span class="p">()</span><span class="o">-</span><span class="n">nkernel_points</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">nkernel_points</span><span class="p">,</span> <span class="n">nkernel_points</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">res</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">+=</span> <span class="n">WF</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="n">G</span><span class="p">[</span><span class="n">jj</span><span class="o">+</span><span class="n">nkernel_points</span><span class="p">]</span>  <span class="c1">#*Gauss(WF.x[ii-jj], WF.x[ii], sigma)</span>
    <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="Reconstruction"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.Reconstruction">[docs]</a><span class="k">def</span> <span class="nf">Reconstruction</span><span class="p">(</span><span class="n">WF</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">tau</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Resamples the input to resolution dx by convolving with a reconstruction filter kernel of width tau&quot;&quot;&quot;</span>
    <span class="n">npoints</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">zeros</span><span class="p">(</span><span class="n">npoints</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="n">zeros</span><span class="p">(</span><span class="n">npoints</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">WF</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
    <span class="n">nkernel_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tau</span> <span class="o">/</span> <span class="n">WF</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span> <span class="c1"># number of points for the current resampled point necessary for the reconstruction from the orginal samples</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nkernel_points = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">nkernel_points</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">Length</span><span class="p">()):</span>
        <span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">ii</span><span class="o">*</span><span class="n">dx</span>
        <span class="c1"># find nearest neighbor to current point x in old data</span>
        <span class="n">kk</span> <span class="o">=</span> <span class="n">WF</span><span class="o">.</span><span class="n">FindNearestNeighbor</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
        <span class="c1"># convolve</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">nkernel_points</span><span class="p">,</span> <span class="n">nkernel_points</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="n">jj</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">kk</span><span class="o">+</span><span class="n">jj</span> <span class="o">&lt;</span> <span class="n">WF</span><span class="o">.</span><span class="n">Length</span><span class="p">()):</span>
                <span class="n">norm</span> <span class="o">+=</span> <span class="n">kernel</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">kk</span><span class="o">+</span><span class="n">jj</span><span class="p">])</span>
                <span class="n">res</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">+=</span> <span class="n">WF</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">kk</span><span class="o">+</span><span class="n">jj</span><span class="p">]</span> <span class="o">*</span> <span class="n">kernel</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">kk</span><span class="o">+</span><span class="n">jj</span><span class="p">])</span>
        <span class="n">res</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">/=</span> <span class="n">norm</span>
    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="Spectrogram"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.Spectrogram">[docs]</a><span class="k">def</span> <span class="nf">Spectrogram</span><span class="p">(</span><span class="n">WF</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Constructs a spectogram of function WF, i.e. computes the frequencies components </span>
<span class="sd">        for n time bins between t0 and t1. The result is a 2D function along time and frequency</span>
<span class="sd">        axis. &#39;kernel&#39; and &#39;sigma&#39; denote the window function and half-width that is used for </span>
<span class="sd">        computing the Fourier transform for a given time bin of width &#39;tau&#39;. &#39;tau&#39; is usually chosen such</span>
<span class="sd">        that the bins overlap.&quot;&quot;&quot;</span>
    <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">spectra</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># Time resolution of WF</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">WF</span><span class="o">.</span><span class="n">dx</span>
    <span class="c1"># number of kernel points for the current time</span>
    <span class="n">nkernel_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tau</span> <span class="o">/</span> <span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> 
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Kernel points : </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">nkernel_points</span><span class="p">)</span>
    <span class="c1"># bin (cell) width as it appears in t-axis of spectogram</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="c1"># start at cell midpoints</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span><span class="o">/</span><span class="mi">2</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
        <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="n">ii</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">f</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># find nearest neighbor to current point x in old data</span>
        <span class="n">kk</span> <span class="o">=</span> <span class="n">WF</span><span class="o">.</span><span class="n">FindNearestNeighbor</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
        <span class="c1"># apply window to current time bin of width tau</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;time = </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">times</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">nkernel_points</span><span class="p">,</span> <span class="n">nkernel_points</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="n">jj</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">kk</span><span class="o">+</span><span class="n">jj</span> <span class="o">&lt;</span> <span class="n">WF</span><span class="o">.</span><span class="n">Length</span><span class="p">()):</span>
                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">kk</span><span class="o">+</span><span class="n">jj</span><span class="p">])</span>
                <span class="n">f</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WF</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">kk</span><span class="o">+</span><span class="n">jj</span><span class="p">]</span> <span class="o">*</span> <span class="n">kernel</span><span class="p">(</span><span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">kk</span><span class="o">+</span><span class="n">jj</span><span class="p">]</span><span class="o">-</span><span class="n">times</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">sigma</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: cannot construct proper window: t = </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">times</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">WF</span><span class="o">.</span><span class="n">dx</span><span class="o">*</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="n">jj</span><span class="p">))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">windowedF</span> <span class="o">=</span> <span class="n">DiscreteFunction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="n">spectra</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">windowedF</span><span class="o">.</span><span class="n">FourierTransform</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">spectra</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">f</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">DiscreteFunction</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">spectra</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span></div>
    


<div class="viewcode-block" id="TanhWindow"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.TanhWindow">[docs]</a><span class="k">def</span> <span class="nf">TanhWindow</span><span class="p">(</span><span class="n">WF</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">sigma0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">sigma1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Applies a tanh filter to the waveform where t0, t1 denote the blending positions and sigma0 and sigma1 the widths of blending&quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">WF</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
    <span class="n">res</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">WF</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">tanh</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="p">(</span><span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">/</span><span class="n">sigma0</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">tanh</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="p">(</span><span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="n">t1</span><span class="p">)</span><span class="o">/</span><span class="n">sigma1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="GaussFilter"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.GaussFilter">[docs]</a><span class="k">def</span> <span class="nf">GaussFilter</span><span class="p">(</span><span class="n">WF</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">sigma0</span><span class="p">,</span> <span class="n">sign</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Applies a (half-)Gaussian filter to the waveform where t0, denotes the blending position and sigma0 the width of blending. </span>
<span class="sd">       sign determines which of the two halfes is chosen.&quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">WF</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">HalfGauss</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">sigma0</span><span class="p">,</span> <span class="n">sign</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">sign</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="n">t0</span><span class="p">:</span> <span class="k">return</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">sign</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="n">t0</span><span class="p">:</span> <span class="k">return</span> <span class="mf">1.0</span>
        <span class="k">return</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma0</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">blend</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">HalfGauss</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">sigma0</span><span class="p">,</span> <span class="n">sign</span><span class="p">),</span> <span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
    <span class="n">res</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">WF</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="n">blend</span>
    <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="ButterworthFilter"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.ButterworthFilter">[docs]</a><span class="k">def</span> <span class="nf">ButterworthFilter</span><span class="p">(</span><span class="n">WF</span><span class="p">,</span> <span class="n">G0</span><span class="p">,</span> <span class="n">omega0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">sign</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Applies a &quot;Butterworth&quot; filter to the waveform where omega0 denotes the blending position and n the order of blending. </span>
<span class="sd">       sign determines which of the two halfes is chosen.&quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">WF</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
    
    <span class="n">blend</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">G0</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="o">/</span><span class="n">omega0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">))),</span> <span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
    <span class="n">res</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">WF</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="n">blend</span>
    <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="ReisswigFilter"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.ReisswigFilter">[docs]</a><span class="k">def</span> <span class="nf">ReisswigFilter</span><span class="p">(</span><span class="n">WF1</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">doItInFreqDomain</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This filter takes the k-th derivative (optionally in the Fourier domain) and then applies Fixed-frequency integration</span>
<span class="sd">        to hi-pass filter the signal &quot;&quot;&quot;</span>
    <span class="n">WF</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">WF1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">WF1</span><span class="o">.</span><span class="n">f</span><span class="p">)</span> <span class="c1">#.conjugate())</span>
    <span class="k">if</span> <span class="n">doItInFreqDomain</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">WF</span> <span class="o">=</span> <span class="n">WF</span><span class="o">.</span><span class="n">FirstDerivative</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="n">WF</span> <span class="o">=</span> <span class="n">WF</span><span class="o">.</span><span class="n">SecondDerivative</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> <span class="n">WF</span> <span class="o">=</span> <span class="n">WF</span><span class="o">.</span><span class="n">SecondDerivative</span><span class="p">()</span><span class="o">.</span><span class="n">SecondDerivative</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">FixedFrequencyIntegration</span><span class="p">(</span><span class="n">WF</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        
    <span class="n">fr</span> <span class="o">=</span> <span class="n">WF</span><span class="o">.</span><span class="n">Extend</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">WF</span><span class="o">.</span><span class="n">Length</span><span class="p">(),</span> <span class="n">WF</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">FourierTransform</span><span class="p">()</span>

    <span class="n">frange</span> <span class="o">=</span> <span class="p">[</span><span class="n">f0</span><span class="p">,</span> <span class="n">f0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fr</span><span class="o">.</span><span class="n">Length</span><span class="p">()):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">div</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">if</span> <span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">frange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">div</span> <span class="o">=</span> <span class="n">frange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
            <span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">fr</span><span class="o">.</span><span class="n">InverseFourierTransform</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="FixedFrequencyIntegration"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.FixedFrequencyIntegration">[docs]</a><span class="k">def</span> <span class="nf">FixedFrequencyIntegration</span><span class="p">(</span><span class="n">WF1</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given some function and frequency f0 (ie omega0/2pi)), we apply the integration scheme proposed by Reisswig&amp;Pollney</span>
<span class="sd">       to get the k-th integral&quot;&quot;&quot;</span>
    <span class="c1"># Put lots of zeros after end of signal in time domain to increase resolution of signal in in frequency domain</span>
    <span class="c1"># and afterwards Fourier-transform</span>
    <span class="n">WF</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">WF1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">WF1</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
    <span class="n">fr</span> <span class="o">=</span> <span class="n">WF</span><span class="o">.</span><span class="n">Extend</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">WF</span><span class="o">.</span><span class="n">Length</span><span class="p">(),</span> <span class="n">WF</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">FourierTransform</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fr</span><span class="o">.</span><span class="n">Length</span><span class="p">()):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="c1">#if fr.x[ii] &lt; 0: fr.f[ii] = 0</span>
            <span class="n">div</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">f0</span><span class="p">):</span> <span class="n">div</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">f0</span><span class="p">)</span><span class="o">*</span><span class="n">sign</span><span class="p">(</span><span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span><span class="o">**</span><span class="n">k</span> <span class="o">*</span> <span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">div</span><span class="o">**</span><span class="n">k</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">fr</span><span class="o">.</span><span class="n">InverseFourierTransform</span><span class="p">()</span>    
        
    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="GethFromPsi4"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.GethFromPsi4">[docs]</a><span class="k">def</span> <span class="nf">GethFromPsi4</span><span class="p">(</span><span class="n">WF1</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given psi4 and frequency f0 (ie omega0/2pi)), we apply the integration scheme proposed by Reisswig&amp;Pollney</span>
<span class="sd">       to get h. n denotes the number of zeros as n times length of signal&quot;&quot;&quot;</span>
    <span class="c1"># Put lots of zeros after end of signal in time domain to increase resolution of signal in in frequency domain</span>
    <span class="c1"># and afterwards Fourier-transform</span>
    <span class="n">WF</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">WF1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">WF1</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">conjugate</span><span class="p">())</span>
    <span class="n">fr</span> <span class="o">=</span> <span class="n">WF</span><span class="o">.</span><span class="n">Extend</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">WF</span><span class="o">.</span><span class="n">Length</span><span class="p">(),</span> <span class="n">WF</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">FourierTransform</span><span class="p">()</span>

    <span class="c1">#frange = [f0, f0+5e-4]</span>
    <span class="n">frange</span> <span class="o">=</span> <span class="p">[</span><span class="n">f0</span><span class="p">,</span> <span class="n">f0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fr</span><span class="o">.</span><span class="n">Length</span><span class="p">()):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="c1">#if fr.x[ii] &lt; 0: fr.f[ii] = 0</span>
            <span class="n">div</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">frange</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span> <span class="n">div</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">frange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
            <span class="c1">#if abs(fr.x[ii]) &lt; abs(frange[0]): div = 4*pi**2*frange[0]**2</span>
            <span class="c1">#if abs(fr.x[ii]) &gt; abs(frange[0]) and abs(fr.x[ii]) &lt; abs(frange[1]): #div = (1.0-GaussBlend(DF1fr.x[ii], frange[0], (frange[1]-frange[0])/100)) * div + GaussBlend(DF1fr.x[ii], frange[0], (frange[1]-frange[0])/100) * 4*pi**2*frange[0]**2</span>
            <span class="c1">#    div = (1 - (abs(fr.x[ii])-abs(frange[0]))/(abs(frange[1]-frange[0]))) * 4*pi**2*frange[0]**2 + (abs(fr.x[ii])-abs(frange[0]))/(abs(frange[1]-frange[0])) * div</span>
            <span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">res</span> <span class="o">=</span> <span class="n">fr</span><span class="o">.</span><span class="n">InverseFourierTransform</span><span class="p">()</span>    
    
    <span class="c1"># Shift peak to zero</span>
    <span class="n">res</span><span class="o">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">res</span><span class="o">.</span><span class="n">FindMax</span><span class="p">()]</span>
    
    <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="GethFromNews"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.GethFromNews">[docs]</a><span class="k">def</span> <span class="nf">GethFromNews</span><span class="p">(</span><span class="n">WF1</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given the news and frequency f0 (ie omega0/2pi)), we apply the integration scheme proposed by Reisswig&amp;Pollney</span>
<span class="sd">       to get h&quot;&quot;&quot;</span>
    <span class="c1"># Put lots of zeros after end of signal in time domain to increase resolution of signal in in frequency domain</span>
    <span class="c1"># and afterwards Fourier-transform</span>
    <span class="n">WF</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">WF1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">WF1</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">conjugate</span><span class="p">())</span>
    <span class="n">fr</span> <span class="o">=</span> <span class="n">WF</span><span class="o">.</span><span class="n">Extend</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">WF</span><span class="o">.</span><span class="n">Length</span><span class="p">(),</span> <span class="n">WF</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">FourierTransform</span><span class="p">()</span>

    <span class="c1">#frange = [omega0-1e-4, omega0]</span>
    <span class="n">frange</span> <span class="o">=</span> <span class="p">[</span><span class="n">f0</span><span class="p">,</span> <span class="n">f0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fr</span><span class="o">.</span><span class="n">Length</span><span class="p">()):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="c1">#if fr.x[ii] &lt; 0: fr.f[ii] = 0</span>
            <span class="n">div</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">frange</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span> <span class="n">div</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">frange</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">sign</span><span class="p">(</span><span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="c1">#if fr.x[ii] &gt; frange[1]: div = 4*pi**2*frange[1]**2</span>
            <span class="c1">#if DF1fr.x[ii] &gt; frange[0] and DF1fr.x[ii] &lt; frange[1]: #div = (1.0-GaussBlend(DF1fr.x[ii], frange[0], (frange[1]-frange[0])/100)) * div + GaussBlend(DF1fr.x[ii], frange[0], (frange[1]-frange[0])/100) * 4*pi**2*frange[0]**2</span>
            <span class="c1">#    div = (1 - (DF1fr.x[ii]-frange[0])/(frange[1]-frange[0])) * 4*pi**2*frange[0]**2 + (DF1fr.x[ii]-frange[0])/(frange[1]-frange[0]) * div</span>
            <span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#plt.loglog(fr.x, abs(fr.f))</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">fr</span><span class="o">.</span><span class="n">InverseFourierTransform</span><span class="p">()</span>    
    
    <span class="c1"># Shift peak to zero</span>
    <span class="c1">#res.x -= res.x[res.FindMax()]</span>
    
    <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="PolynomialFilterDriver"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.PolynomialFilterDriver">[docs]</a><span class="k">def</span> <span class="nf">PolynomialFilterDriver</span><span class="p">(</span><span class="n">WFfr</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">blend</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a waveform in Fourier domain, we fit a polynomial between frequncy range frange as</span>
<span class="sd">       described in Reisswig&amp;Pollney 2010&quot;&quot;&quot;</span>
    <span class="n">fr</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">WFfr</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">WFfr</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
    
    <span class="n">b</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">x0</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">x0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="n">b</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;a = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">a</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;b = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">GaussBlend</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">s0</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">s0</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">x_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">f_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">x_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">f_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fr</span><span class="o">.</span><span class="n">Length</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">fac</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">WFfr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">WFfr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">**</span><span class="n">b</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">blend</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x0</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span> <span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">/=</span> <span class="n">fac</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">blend</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">x0</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span> <span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">GaussBlend</span><span class="p">(</span><span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">10</span><span class="p">))</span> <span class="o">*</span> <span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">/</span><span class="n">fac</span> <span class="o">+</span> <span class="n">GaussBlend</span><span class="p">(</span><span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
            <span class="c1">#if (DF2.x[ii] &gt;= 0 and DF2.x[ii] &lt;= x0[0]):</span>
            <span class="c1">#    x_.append(DF2.x[ii])</span>
            <span class="c1">#    f_.append(fac)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span> <span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#H = WaveFunction(x_, f_)</span>
    <span class="c1">#return DF2, H </span>
    <span class="k">return</span> <span class="n">fr</span></div>


<div class="viewcode-block" id="GethFromPsi4Filtered"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.GethFromPsi4Filtered">[docs]</a><span class="k">def</span> <span class="nf">GethFromPsi4Filtered</span><span class="p">(</span><span class="n">WF1</span><span class="p">,</span> <span class="n">frange</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given psi4 and frequency f0 (ie omega0/2pi)), we apply the integration scheme proposed by Reisswig&amp;Pollney by applying a filter</span>
<span class="sd">       to get h. n denotes the number of zeros as n times length of signal&quot;&quot;&quot;</span>
    <span class="c1"># Put lots of zeros after end of signal in time domain to increase resolution of signal in in frequency domain</span>
    <span class="c1"># and afterwards Fourier-transform</span>
    <span class="n">WF</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">WF1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">WF1</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">conjugate</span><span class="p">())</span>
    <span class="n">fr</span> <span class="o">=</span> <span class="n">WF</span><span class="o">.</span><span class="n">Extend</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">WF</span><span class="o">.</span><span class="n">Length</span><span class="p">(),</span> <span class="n">WF</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">FourierTransform</span><span class="p">()</span>
    <span class="n">frAbs</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">))</span>

    <span class="c1"># Find slope</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="p">[</span><span class="n">frange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">frAbs</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="n">frange</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="p">[</span><span class="n">frange</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">frAbs</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="n">frange</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    
    <span class="n">fr</span> <span class="o">=</span> <span class="n">PolynomialFilterDriver</span><span class="p">(</span><span class="n">fr</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fr</span><span class="o">.</span><span class="n">Length</span><span class="p">()):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">div</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">fr</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fr</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">res</span> <span class="o">=</span> <span class="n">fr</span><span class="o">.</span><span class="n">InverseFourierTransform</span><span class="p">()</span>    
    
    <span class="c1"># Shift peak to zero</span>
    <span class="c1">#res.x -= res.x[res.FindMax()]</span>
    
    <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="LuminosityDistance"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.LuminosityDistance">[docs]</a><span class="k">def</span> <span class="nf">LuminosityDistance</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">Omega_m</span><span class="o">=</span><span class="mf">0.3175</span><span class="p">,</span> <span class="n">Omega_lambda</span><span class="o">=</span><span class="mf">0.6825</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computes the luminosity distance in Mpc for a given redshift z</span>
<span class="sd">       Code from Ed Wright http://www.astro.ucla.edu/~wright/CosmoCalc.html&quot;&quot;&quot;</span>
    
    <span class="n">H0</span> <span class="o">=</span> <span class="n">constant_H0</span>
    <span class="n">WM</span> <span class="o">=</span> <span class="n">Omega_m</span> <span class="c1"># Omega(matter)</span>
    <span class="n">WV</span> <span class="o">=</span> <span class="n">Omega_lambda</span> <span class="c1"># Omega(vacuum) or lambda</span>
    
    <span class="n">WR</span> <span class="o">=</span> <span class="mf">0.</span>        <span class="c1"># Omega(radiation)</span>
    <span class="n">WK</span> <span class="o">=</span> <span class="mf">0.</span>        <span class="c1"># Omega curvaturve = 1-Omega(total)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mf">299792.458</span> <span class="c1"># velocity of light in km/sec</span>
    <span class="n">Tyr</span> <span class="o">=</span> <span class="mf">977.8</span>    <span class="c1"># coefficent for converting 1/H into Gyr</span>
    <span class="n">DTT</span> <span class="o">=</span> <span class="mf">0.5</span>      <span class="c1"># time from z to now in units of 1/H0</span>
    <span class="n">DTT_Gyr</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># value of DTT in Gyr</span>
    <span class="n">age</span> <span class="o">=</span> <span class="mf">0.5</span>      <span class="c1"># age of Universe in units of 1/H0</span>
    <span class="n">age_Gyr</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># value of age in Gyr</span>
    <span class="n">zage</span> <span class="o">=</span> <span class="mf">0.1</span>     <span class="c1"># age of Universe at redshift z in units of 1/H0</span>
    <span class="n">zage_Gyr</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># value of zage in Gyr</span>
    <span class="n">DCMR</span> <span class="o">=</span> <span class="mf">0.0</span>     <span class="c1"># comoving radial distance in units of c/H0</span>
    <span class="n">DCMR_Mpc</span> <span class="o">=</span> <span class="mf">0.0</span> 
    <span class="n">DCMR_Gyr</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">DA</span> <span class="o">=</span> <span class="mf">0.0</span>       <span class="c1"># angular size distance</span>
    <span class="n">DA_Mpc</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">DA_Gyr</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">kpc_DA</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">DL</span> <span class="o">=</span> <span class="mf">0.0</span>       <span class="c1"># luminosity distance</span>
    <span class="n">DL_Mpc</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">DL_Gyr</span> <span class="o">=</span> <span class="mf">0.0</span>   <span class="c1"># DL in units of billions of light years</span>
    <span class="n">V_Gpc</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mf">1.0</span>        <span class="c1"># 1/(1+z), the scale factor of the Universe</span>
    <span class="n">az</span> <span class="o">=</span> <span class="mf">0.5</span>       <span class="c1"># 1/(1+z(object))</span>
    
    <span class="n">h</span> <span class="o">=</span> <span class="n">H0</span><span class="o">/</span><span class="mf">100.</span>
    <span class="n">WR</span> <span class="o">=</span> <span class="mf">4.165E-5</span><span class="o">/</span><span class="p">(</span><span class="n">h</span><span class="o">*</span><span class="n">h</span><span class="p">)</span>   <span class="c1"># includes 3 massless neutrino species, T0 = 2.72528</span>
    <span class="n">WK</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">WM</span><span class="o">-</span><span class="n">WR</span><span class="o">-</span><span class="n">WV</span>
    <span class="n">az</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">1.0</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>
    <span class="n">age</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">n</span><span class="o">=</span><span class="mi">1000</span>         <span class="c1"># number of points in integrals</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">az</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">n</span>
        <span class="n">adot</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">WK</span><span class="o">+</span><span class="p">(</span><span class="n">WM</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">WR</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">))</span><span class="o">+</span><span class="p">(</span><span class="n">WV</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">))</span>
        <span class="n">age</span> <span class="o">=</span> <span class="n">age</span> <span class="o">+</span> <span class="mf">1.</span><span class="o">/</span><span class="n">adot</span>

    <span class="n">zage</span> <span class="o">=</span> <span class="n">az</span><span class="o">*</span><span class="n">age</span><span class="o">/</span><span class="n">n</span>
    <span class="n">zage_Gyr</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tyr</span><span class="o">/</span><span class="n">H0</span><span class="p">)</span><span class="o">*</span><span class="n">zage</span>
    <span class="n">DTT</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">DCMR</span> <span class="o">=</span> <span class="mf">0.0</span>
    
    <span class="k">def</span> <span class="nf">DCMT</span><span class="p">():</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="mf">1.00</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">WK</span><span class="p">))</span><span class="o">*</span><span class="n">DCMR</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">WK</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span> <span class="n">ratio</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="n">x</span> 
            <span class="k">else</span><span class="p">:</span> <span class="n">ratio</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">x</span><span class="p">;</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">ratio</span><span class="o">*</span><span class="n">DCMR</span>
            <span class="k">return</span> <span class="n">y</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span>
        <span class="c1"># statement below fixed 13-Aug-03 to correct sign error in expansion</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">WK</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span> <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">y</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">y</span><span class="o">/</span><span class="mi">6</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="o">/</span><span class="mi">120</span>
        <span class="n">y</span><span class="o">=</span> <span class="n">ratio</span><span class="o">*</span><span class="n">DCMR</span>
        <span class="k">return</span> <span class="n">y</span>


    <span class="k">def</span> <span class="nf">VCM</span><span class="p">():</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="mf">1.00</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">WK</span><span class="p">))</span><span class="o">*</span><span class="n">DCMR</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">WK</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span> <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.125</span><span class="o">*</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">))</span><span class="o">-</span><span class="n">x</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">ratio</span><span class="o">*</span><span class="n">DCMR</span><span class="o">*</span><span class="n">DCMR</span><span class="o">*</span><span class="n">DCMR</span><span class="o">/</span><span class="mi">3</span>
            <span class="k">return</span> <span class="n">y</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span>
        <span class="c1"># statement below fixed 13-Aug-03 to correct sign error in expansion</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">WK</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span> <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">y</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">y</span><span class="o">/</span><span class="mi">5</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">105</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">y</span>
        <span class="n">y</span><span class="o">=</span> <span class="n">ratio</span><span class="o">*</span><span class="n">DCMR</span><span class="o">*</span><span class="n">DCMR</span><span class="o">*</span><span class="n">DCMR</span><span class="o">/</span><span class="mi">3</span>
        <span class="k">return</span> <span class="n">y</span>
    
    
    <span class="n">h</span> <span class="o">=</span> <span class="n">H0</span><span class="o">/</span><span class="mi">100</span>
    <span class="n">WR</span> <span class="o">=</span> <span class="mf">4.165E-5</span><span class="o">/</span><span class="p">(</span><span class="n">h</span><span class="o">*</span><span class="n">h</span><span class="p">)</span> <span class="c1"># includes 3 massless neutrino species, T0 = 2.72528</span>
    <span class="n">WK</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">WM</span><span class="o">-</span><span class="n">WR</span><span class="o">-</span><span class="n">WV</span>
    <span class="n">az</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">1.0</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>
    <span class="n">age</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">az</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">n</span>
        <span class="n">adot</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">WK</span><span class="o">+</span><span class="p">(</span><span class="n">WM</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">WR</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">))</span><span class="o">+</span><span class="p">(</span><span class="n">WV</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">))</span>
        <span class="n">age</span> <span class="o">=</span> <span class="n">age</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">adot</span>
    <span class="n">zage</span> <span class="o">=</span> <span class="n">az</span><span class="o">*</span><span class="n">age</span><span class="o">/</span><span class="n">n</span>
    <span class="c1"># correction for annihilations of particles not present now like e+/e-</span>
    <span class="c1"># added 13-Aug-03 based on T_vs_t.f</span>
    <span class="n">lpz</span> <span class="o">=</span> <span class="n">log</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="mf">1.0</span><span class="o">*</span><span class="n">z</span><span class="p">))</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span>
    <span class="n">dzage</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">&gt;</span>  <span class="mf">7.500</span><span class="p">):</span> <span class="n">dzage</span> <span class="o">=</span> <span class="mf">0.002</span> <span class="o">*</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">-</span>  <span class="mf">7.500</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">&gt;</span>  <span class="mf">8.000</span><span class="p">):</span> <span class="n">dzage</span> <span class="o">=</span> <span class="mf">0.014</span> <span class="o">*</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">-</span>  <span class="mf">8.000</span><span class="p">)</span> <span class="o">+</span>  <span class="mf">0.001</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">&gt;</span>  <span class="mf">8.500</span><span class="p">):</span> <span class="n">dzage</span> <span class="o">=</span> <span class="mf">0.040</span> <span class="o">*</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">-</span>  <span class="mf">8.500</span><span class="p">)</span> <span class="o">+</span>  <span class="mf">0.008</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">&gt;</span>  <span class="mf">9.000</span><span class="p">):</span> <span class="n">dzage</span> <span class="o">=</span> <span class="mf">0.020</span> <span class="o">*</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">-</span>  <span class="mf">9.000</span><span class="p">)</span> <span class="o">+</span>  <span class="mf">0.028</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">&gt;</span>  <span class="mf">9.500</span><span class="p">):</span> <span class="n">dzage</span> <span class="o">=</span> <span class="mf">0.019</span> <span class="o">*</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">-</span>  <span class="mf">9.500</span><span class="p">)</span> <span class="o">+</span>  <span class="mf">0.039</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">&gt;</span> <span class="mf">10.000</span><span class="p">):</span> <span class="n">dzage</span> <span class="o">=</span> <span class="mf">0.048</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">&gt;</span> <span class="mf">10.775</span><span class="p">):</span> <span class="n">dzage</span> <span class="o">=</span> <span class="mf">0.035</span> <span class="o">*</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">-</span> <span class="mf">10.775</span><span class="p">)</span> <span class="o">+</span>  <span class="mf">0.048</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">&gt;</span> <span class="mf">11.851</span><span class="p">):</span> <span class="n">dzage</span> <span class="o">=</span> <span class="mf">0.069</span> <span class="o">*</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">-</span> <span class="mf">11.851</span><span class="p">)</span> <span class="o">+</span>  <span class="mf">0.086</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">&gt;</span> <span class="mf">12.258</span><span class="p">):</span> <span class="n">dzage</span> <span class="o">=</span> <span class="mf">0.461</span> <span class="o">*</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">-</span> <span class="mf">12.258</span><span class="p">)</span> <span class="o">+</span>  <span class="mf">0.114</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">&gt;</span> <span class="mf">12.382</span><span class="p">):</span> <span class="n">dzage</span> <span class="o">=</span> <span class="mf">0.024</span> <span class="o">*</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">-</span> <span class="mf">12.382</span><span class="p">)</span> <span class="o">+</span>  <span class="mf">0.171</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">&gt;</span> <span class="mf">13.055</span><span class="p">):</span> <span class="n">dzage</span> <span class="o">=</span> <span class="mf">0.013</span> <span class="o">*</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">-</span> <span class="mf">13.055</span><span class="p">)</span> <span class="o">+</span>  <span class="mf">0.188</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">&gt;</span> <span class="mf">14.081</span><span class="p">):</span> <span class="n">dzage</span> <span class="o">=</span> <span class="mf">0.013</span> <span class="o">*</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">-</span> <span class="mf">14.081</span><span class="p">)</span> <span class="o">+</span>  <span class="mf">0.201</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lpz</span> <span class="o">&gt;</span> <span class="mf">15.107</span><span class="p">):</span> <span class="n">dzage</span> <span class="o">=</span> <span class="mf">0.214</span>
    <span class="n">zage</span> <span class="o">=</span> <span class="n">zage</span><span class="o">*</span><span class="mf">10.0</span><span class="o">**</span><span class="n">dzage</span>

    <span class="n">zage_Gyr</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tyr</span><span class="o">/</span><span class="n">H0</span><span class="p">)</span><span class="o">*</span><span class="n">zage</span>
    <span class="n">DTT</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">DCMR</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c1"># do integral over a=1/(1+z) from az to 1 in n steps, midpoint rule</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">az</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">az</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">n</span>
        <span class="n">adot</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">WK</span><span class="o">+</span><span class="p">(</span><span class="n">WM</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">WR</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">))</span><span class="o">+</span><span class="p">(</span><span class="n">WV</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">))</span>
        <span class="n">DTT</span> <span class="o">=</span> <span class="n">DTT</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">adot</span>
        <span class="n">DCMR</span> <span class="o">=</span> <span class="n">DCMR</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">adot</span><span class="p">)</span>

    <span class="n">DTT</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">az</span><span class="p">)</span><span class="o">*</span><span class="n">DTT</span><span class="o">/</span><span class="n">n</span>
    <span class="n">DCMR</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">az</span><span class="p">)</span><span class="o">*</span><span class="n">DCMR</span><span class="o">/</span><span class="n">n</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">DTT</span><span class="o">+</span><span class="n">zage</span>
    <span class="n">age_Gyr</span> <span class="o">=</span> <span class="n">age</span><span class="o">*</span><span class="p">(</span><span class="n">Tyr</span><span class="o">/</span><span class="n">H0</span><span class="p">)</span>
    <span class="n">DTT_Gyr</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tyr</span><span class="o">/</span><span class="n">H0</span><span class="p">)</span><span class="o">*</span><span class="n">DTT</span>
    <span class="n">DCMR_Gyr</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tyr</span><span class="o">/</span><span class="n">H0</span><span class="p">)</span><span class="o">*</span><span class="n">DCMR</span>
    <span class="n">DCMR_Mpc</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="n">H0</span><span class="p">)</span><span class="o">*</span><span class="n">DCMR</span>
    <span class="n">DA</span> <span class="o">=</span> <span class="n">az</span><span class="o">*</span><span class="n">DCMT</span><span class="p">()</span>
    <span class="n">DA_Mpc</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="n">H0</span><span class="p">)</span><span class="o">*</span><span class="n">DA</span>
    <span class="n">kpc_DA</span> <span class="o">=</span> <span class="n">DA_Mpc</span><span class="o">/</span><span class="mf">206.264806</span>
    <span class="n">DA_Gyr</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tyr</span><span class="o">/</span><span class="n">H0</span><span class="p">)</span><span class="o">*</span><span class="n">DA</span>
    <span class="n">DL</span> <span class="o">=</span> <span class="n">DA</span><span class="o">/</span><span class="p">(</span><span class="n">az</span><span class="o">*</span><span class="n">az</span><span class="p">)</span>
    <span class="n">DL_Mpc</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="n">H0</span><span class="p">)</span><span class="o">*</span><span class="n">DL</span>
    <span class="n">DL_Gyr</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tyr</span><span class="o">/</span><span class="n">H0</span><span class="p">)</span><span class="o">*</span><span class="n">DL</span>
    <span class="n">V_Gpc</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="nb">pow</span><span class="p">(</span><span class="mf">0.001</span><span class="o">*</span><span class="n">c</span><span class="o">/</span><span class="n">H0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">VCM</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">DL_Mpc</span></div>


<div class="viewcode-block" id="ShiftToZero"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.ShiftToZero">[docs]</a><span class="k">def</span> <span class="nf">ShiftToZero</span><span class="p">(</span><span class="n">DF</span><span class="p">,</span> <span class="n">trange</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a range [.,.] shift the wave according to that intervall to zero&quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">trange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">DF</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ShiftToZero: trange[1] out of bounds&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">trange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">DF</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ShiftToZero: trange[0] out of bounds&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">DF</span><span class="o">.</span><span class="n">Length</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">DF</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">trange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">DF</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">trange</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">DF</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">DF</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">DF</span><span class="o">.</span><span class="n">f</span> <span class="o">-</span> <span class="n">s</span><span class="o">/</span><span class="n">n</span><span class="p">)</span></div>


<div class="viewcode-block" id="GethFD"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.GethFD">[docs]</a><span class="k">def</span> <span class="nf">GethFD</span><span class="p">(</span><span class="n">WF</span><span class="p">,</span> <span class="n">wf_type</span><span class="o">=</span><span class="s1">&#39;news&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given psi4 or the news in Fourier domain this returns h in Fourier domain&quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">WF</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wf_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;psi4&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WF</span><span class="o">.</span><span class="n">Length</span><span class="p">()):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">res</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">WF</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WF</span><span class="o">.</span><span class="n">Length</span><span class="p">()):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">res</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="n">WF</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="GethTD"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.GethTD">[docs]</a><span class="k">def</span> <span class="nf">GethTD</span><span class="p">(</span><span class="n">WF</span><span class="p">,</span> <span class="n">wf_type</span><span class="o">=</span><span class="s1">&#39;news&#39;</span><span class="p">,</span> <span class="n">shiftToZero</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given psi4 or the news in the time domain this returns h in the time domain&quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">WF</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">WF</span><span class="o">.</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">IntegrateFunction</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">shiftToZero</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Have to implement the shift-to-zero&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">wf_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;psi4&#39;</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">IntegrateFunction</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">shiftToZero</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Have to implement the shift-to-zero&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span></div>
    
<div class="viewcode-block" id="InitModeArray"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.InitModeArray">[docs]</a><span class="k">def</span> <span class="nf">InitModeArray</span><span class="p">(</span><span class="n">lmax</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates an array with empty modes up to lmax&quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">ll</span><span class="p">,</span> <span class="n">ll</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">res</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
    <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="LoadModeArray"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.LoadModeArray">[docs]</a><span class="k">def</span> <span class="nf">LoadModeArray</span><span class="p">(</span><span class="n">basename</span><span class="p">,</span> <span class="n">lmax</span><span class="p">,</span> <span class="n">col_time</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col_re</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col_im</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">filenameformat</span><span class="o">=</span><span class="s2">&quot;cce_conversion_script&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loads an array of modes up to lmax from disk.</span>
<span class="sd">       We assume that files begin with &#39;basename&#39; and end with _l*m*.dat&quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">InitModeArray</span><span class="p">(</span><span class="n">lmax</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">ll</span><span class="p">,</span> <span class="n">ll</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">filenameformat</span> <span class="o">==</span> <span class="s2">&quot;cce_conversion_script&quot;</span><span class="p">):</span>
                <span class="n">res</span><span class="p">[</span><span class="n">ll</span><span class="p">][</span><span class="n">mm</span><span class="p">]</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">([],</span> <span class="p">[])</span>
                <span class="n">res</span><span class="p">[</span><span class="n">ll</span><span class="p">][</span><span class="n">mm</span><span class="p">]</span><span class="o">.</span><span class="n">Load</span><span class="p">(</span><span class="n">basename</span><span class="o">+</span><span class="s2">&quot;_l&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;m&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">mm</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.dat&quot;</span><span class="p">,</span> <span class="n">col_time</span><span class="p">,</span> <span class="n">col_re</span><span class="p">,</span> <span class="n">col_im</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">filenameformat</span> <span class="o">==</span> <span class="s2">&quot;pittnull&quot;</span><span class="p">):</span>
                <span class="n">res</span><span class="p">[</span><span class="n">ll</span><span class="p">][</span><span class="o">-</span><span class="n">mm</span><span class="p">]</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">([],</span> <span class="p">[])</span>
                <span class="c1"># Get spaces from Fortran outpout filenames right</span>
                <span class="n">tmp1</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%02d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ll</span>
                <span class="k">if</span> <span class="n">mm</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">tmp2</span> <span class="o">=</span> <span class="s2">&quot;m&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmp2</span> <span class="o">=</span> <span class="s2">&quot;p&quot;</span>
                <span class="n">tmp2</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%02d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mm</span><span class="p">)</span>
                <span class="c1"># Take into account that nullcode has a weird convention for psi4!</span>
                <span class="n">res</span><span class="p">[</span><span class="n">ll</span><span class="p">][</span><span class="o">-</span><span class="n">mm</span><span class="p">]</span><span class="o">.</span><span class="n">Load</span><span class="p">(</span><span class="n">basename</span><span class="o">+</span><span class="s2">&quot;.L&quot;</span><span class="o">+</span><span class="n">tmp1</span><span class="o">+</span><span class="s2">&quot;M&quot;</span><span class="o">+</span><span class="n">tmp2</span><span class="o">+</span><span class="s2">&quot;.asc&quot;</span><span class="p">,</span> <span class="n">col_time</span><span class="p">,</span> <span class="n">col_re</span><span class="p">,</span> <span class="n">col_im</span><span class="p">)</span>
                <span class="n">res</span><span class="p">[</span><span class="n">ll</span><span class="p">][</span><span class="o">-</span><span class="n">mm</span><span class="p">]</span><span class="o">.</span><span class="n">f</span> <span class="o">*=</span> <span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">mm</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">res</span><span class="p">[</span><span class="n">ll</span><span class="p">][</span><span class="o">-</span><span class="n">mm</span><span class="p">]</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(),</span> <span class="n">res</span><span class="p">[</span><span class="n">ll</span><span class="p">][</span><span class="o">-</span><span class="n">mm</span><span class="p">]</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error loading mode array: filenameformat not recognized!&quot;</span><span class="p">)</span>
                
    <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="ReconFromsYlm"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.ReconFromsYlm">[docs]</a><span class="k">def</span> <span class="nf">ReconFromsYlm</span><span class="p">(</span><span class="n">arrayWF</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">lmax</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given an array of WF modes h_lm reconstruct h at angle theta, phi up to l=lmax&quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">arrayWF</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">arrayWF</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">f</span><span class="o">*</span><span class="mf">0.0</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">ll</span><span class="p">,</span> <span class="n">ll</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">res</span><span class="o">.</span><span class="n">f</span> <span class="o">+=</span> <span class="n">sYlm</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">ll</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">arrayWF</span><span class="p">[</span><span class="n">ll</span><span class="p">][</span><span class="n">mm</span><span class="p">]</span><span class="o">.</span><span class="n">f</span>
            
    <span class="k">return</span> <span class="n">res</span> </div>
    

<div class="viewcode-block" id="SensitivityLIGO"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.SensitivityLIGO">[docs]</a><span class="k">def</span> <span class="nf">SensitivityLIGO</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="n">f0</span> <span class="o">=</span> <span class="mf">150.0</span>
    <span class="n">s0</span> <span class="o">=</span> <span class="mf">9.0e-46</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">s0</span> <span class="o">*</span> <span class="p">((</span><span class="mf">4.49</span><span class="o">*</span><span class="n">f</span><span class="o">/</span><span class="n">f0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">56.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.16</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="o">/</span><span class="n">f0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">4.52</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.52</span> <span class="o">+</span> <span class="mf">0.32</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="o">/</span><span class="n">f0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">S</span></div>

<div class="viewcode-block" id="SensitivityeLIGO"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.SensitivityeLIGO">[docs]</a><span class="k">def</span> <span class="nf">SensitivityeLIGO</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">eLIGOcurve</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></div>

<div class="viewcode-block" id="SensitivityAdLIGO_Old"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.SensitivityAdLIGO_Old">[docs]</a><span class="k">def</span> <span class="nf">SensitivityAdLIGO_Old</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This curve is an old one!&quot;&quot;&quot;</span>
    <span class="n">f0</span> <span class="o">=</span> <span class="mf">215.0</span>
    <span class="n">S0</span> <span class="o">=</span> <span class="mf">1.0e-49</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">S0</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="n">f</span><span class="o">/</span><span class="n">f0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">4.14</span><span class="p">)</span> <span class="o">-</span> <span class="mf">5.0</span><span class="o">*</span><span class="p">(</span><span class="n">f0</span><span class="o">/</span><span class="n">f</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">111.0</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">f</span><span class="o">/</span><span class="n">f0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="o">/</span><span class="n">f0</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="o">/</span><span class="n">f0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">S</span></div>

<div class="viewcode-block" id="SensitivityAdLIGO"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.SensitivityAdLIGO">[docs]</a><span class="k">def</span> <span class="nf">SensitivityAdLIGO</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This curve is using most likely data points from 25. Jan. 2010, LIGO Document T0900288-v3&quot;&quot;&quot;</span>
    <span class="c1"># web-adress: https://dcc.ligo.org/cgi-bin/DocDB/ShowDocument?docid=2974 </span>
    <span class="k">return</span> <span class="n">AdLIGOcurve</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span></div>


<div class="viewcode-block" id="SensitivityVirgo"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.SensitivityVirgo">[docs]</a><span class="k">def</span> <span class="nf">SensitivityVirgo</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="n">s0</span> <span class="o">=</span> <span class="mf">10.2e-46</span>
    <span class="n">f0</span> <span class="o">=</span> <span class="mf">500.0</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">s0</span> <span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="mf">7.87</span><span class="o">*</span><span class="n">f</span><span class="o">/</span><span class="n">f0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">4.8</span><span class="p">)</span> <span class="o">+</span> <span class="mf">6.0</span><span class="o">/</span><span class="mf">17.0</span> <span class="o">*</span> <span class="n">f0</span><span class="o">/</span><span class="n">f</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">f</span><span class="o">/</span><span class="n">f0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>    
    <span class="k">return</span> <span class="n">S</span></div>


<div class="viewcode-block" id="SensitivityAdVirgo"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.SensitivityAdVirgo">[docs]</a><span class="k">def</span> <span class="nf">SensitivityAdVirgo</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">AdVirgocurve</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span></div>


<div class="viewcode-block" id="UnitStep"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.UnitStep">[docs]</a><span class="k">def</span> <span class="nf">UnitStep</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Step function&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="mf">0.0</span></div>

<div class="viewcode-block" id="SensitivityLISA"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.SensitivityLISA">[docs]</a><span class="k">def</span> <span class="nf">SensitivityLISA</span><span class="p">(</span><span class="n">F</span><span class="p">):</span>
    <span class="c1"># code due to Miquel Trias, see LISA PE Wiki, \</span>
    <span class="c1"># http://www.tapir.caltech.edu/dokuwiki/lisape:home</span>
    <span class="c1"># We used this curve for the Detection paper.</span>
    
    <span class="n">Fst</span> <span class="o">=</span> <span class="mf">9.542690318473885</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">);</span>
    <span class="n">Larm</span> <span class="o">=</span> <span class="mi">5</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">9</span><span class="p">;</span>
    <span class="n">SPS</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">22</span><span class="p">);</span>
    <span class="n">SACC</span> <span class="o">=</span> <span class="mi">9</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">);</span>
    <span class="n">red</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">;</span>
    
    <span class="n">n0</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">Larm</span><span class="o">**</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">SPS</span><span class="p">;</span>
    <span class="n">n2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">16.0</span><span class="o">*</span><span class="n">SACC</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">F</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span><span class="p">;</span>
    <span class="n">n3</span> <span class="o">=</span> <span class="p">(</span><span class="mf">16.0</span><span class="o">*</span><span class="n">SACC</span><span class="o">*</span><span class="n">red</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">F</span><span class="p">)</span><span class="o">**</span><span class="mi">6</span><span class="p">;</span>
    <span class="n">n4</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="n">F</span><span class="o">/</span><span class="n">Fst</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">SPS</span><span class="p">;</span>
    
    <span class="n">conf</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">**-</span><span class="mf">44.62</span><span class="o">*</span><span class="n">F</span><span class="o">**-</span><span class="mf">2.3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">UnitStep</span><span class="p">(</span><span class="n">F</span> <span class="o">-</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">10</span><span class="o">**-</span><span class="mf">50.92</span><span class="o">*</span>
          <span class="n">F</span><span class="o">**-</span><span class="mf">4.4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">UnitStep</span><span class="p">(</span><span class="n">F</span> <span class="o">-</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> 
            <span class="n">UnitStep</span><span class="p">(</span><span class="n">F</span> <span class="o">-</span> <span class="mi">10</span><span class="o">**-</span><span class="mf">2.7</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">10</span><span class="o">**-</span><span class="mf">62.8</span><span class="o">*</span>
          <span class="n">F</span><span class="o">**-</span><span class="mf">8.8</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">UnitStep</span><span class="p">(</span><span class="n">F</span> <span class="o">-</span> <span class="mi">10</span><span class="o">**-</span><span class="mf">2.7</span><span class="p">)</span> <span class="o">-</span> 
            <span class="n">UnitStep</span><span class="p">(</span><span class="n">F</span> <span class="o">-</span> <span class="mi">10</span><span class="o">**-</span><span class="mf">2.4</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">10</span><span class="o">**-</span><span class="mf">89.68</span><span class="o">*</span>
          <span class="n">F</span><span class="o">**-</span><span class="mi">20</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">UnitStep</span><span class="p">(</span><span class="n">F</span> <span class="o">-</span> <span class="mi">10</span><span class="o">**-</span><span class="mf">2.4</span><span class="p">)</span> <span class="o">-</span> <span class="n">UnitStep</span><span class="p">(</span><span class="n">F</span> <span class="o">-</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">2</span><span class="p">));</span>
    
    <span class="n">S</span> <span class="o">=</span> <span class="n">n0</span><span class="o">*</span><span class="p">(</span><span class="n">n1</span> <span class="o">+</span> <span class="n">n2</span> <span class="o">+</span> <span class="n">n3</span> <span class="o">+</span> <span class="n">n4</span><span class="p">)</span> <span class="o">+</span> <span class="n">conf</span>
    <span class="k">return</span> <span class="n">S</span></div>


<div class="viewcode-block" id="SensitivityLISA_Berti"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.SensitivityLISA_Berti">[docs]</a><span class="k">def</span> <span class="nf">SensitivityLISA_Berti</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="c1"># Noise curve from Eq. (2.31) of http://arxiv.org/abs/gr-qc/0411129v2</span>
    <span class="c1"># Suggested by Ajith. However, the other curve seems to be somewhat newer...</span>
    <span class="c1"># There is no real &quot;official&quot; LISA curve to date.</span>
    
    <span class="n">S_NSA</span> <span class="o">=</span> <span class="p">(</span><span class="mf">9.18</span><span class="o">*</span><span class="mf">1e-52</span> <span class="o">*</span> <span class="n">f</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mf">1.59</span><span class="o">*</span><span class="mf">1e-41</span> <span class="o">+</span> <span class="mf">9.18</span><span class="o">*</span><span class="mf">1e-38</span> <span class="o">*</span> <span class="n">f</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">S_gal</span> <span class="o">=</span> <span class="mf">2.1</span><span class="o">*</span><span class="mf">1e-45</span> <span class="o">*</span> <span class="n">f</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">7.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span>
    <span class="n">S_ex_gal</span> <span class="o">=</span> <span class="mf">4.2</span><span class="o">*</span><span class="mf">1e-47</span> <span class="o">*</span> <span class="n">f</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">7.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span>
    
    <span class="c1">#T_mission = </span>
    <span class="c1">#kappa = 4.5</span>
    
    <span class="c1">#S = min([S_NSA ]) + </span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">S_NSA</span> <span class="o">+</span> <span class="n">S_gal</span> <span class="o">+</span> <span class="n">S_ex_gal</span>
    
    <span class="k">return</span> <span class="n">S</span></div>


<div class="viewcode-block" id="SensitivityeLISA"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.SensitivityeLISA">[docs]</a><span class="k">def</span> <span class="nf">SensitivityeLISA</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="c1"># Noise curve for eLISA-NGO.</span>
    <span class="c1"># Function from eLISA yellow book, Sec. 4.3</span>
    
    <span class="n">f0</span> <span class="o">=</span> <span class="mf">150.0e-3</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mf">0.41</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="p">(</span><span class="n">f</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">f0</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">Da0</span> <span class="o">=</span> <span class="mf">3.0</span>
    <span class="n">fL</span> <span class="o">=</span> <span class="mf">0.1e-3</span>
    <span class="n">fH</span> <span class="o">=</span> <span class="mf">8.0e-3</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">Da0</span><span class="o">*</span><span class="mf">1.0e-15</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="p">(</span><span class="n">f</span><span class="o">/</span><span class="n">fH</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">fL</span><span class="o">/</span><span class="n">f</span><span class="p">)</span>
    
    <span class="n">dx_DRS</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">da</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">f</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="n">Dx0</span> <span class="o">=</span> <span class="mf">12.0</span>
    <span class="n">f0</span> <span class="o">=</span> <span class="mf">2.8e-3</span>
    <span class="n">dx_IMS</span> <span class="o">=</span> <span class="n">Dx0</span><span class="o">*</span><span class="mf">1e-12</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="p">(</span><span class="n">f0</span><span class="o">/</span><span class="n">f</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
    
    <span class="c1"># Is this correct??? No...</span>
    <span class="n">S_IMS</span> <span class="o">=</span> <span class="n">dx_IMS</span>
    <span class="n">S_DRS</span> <span class="o">=</span> <span class="n">dx_DRS</span>
    
    <span class="c1"># arm length</span>
    <span class="n">L</span> <span class="o">=</span> <span class="mf">1e9</span>
    
    <span class="c1">#h = sqrt(5.0)*2.0/sqrt(3.0)*T*sqrt(S_IMS + S_DRS) / L</span>
    <span class="c1"># Use this in terms of dx_IMS, dx_DRS:</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span><span class="o">*</span><span class="mf">2.0</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="p">(</span><span class="n">dx_IMS</span> <span class="o">+</span> <span class="n">dx_DRS</span><span class="p">)</span> <span class="o">/</span> <span class="n">L</span>
    
    <span class="n">S</span> <span class="o">=</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="k">return</span> <span class="n">S</span></div>


<div class="viewcode-block" id="SensitivityDECIGO"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.SensitivityDECIGO">[docs]</a><span class="k">def</span> <span class="nf">SensitivityDECIGO</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; From arXiv:1110.2865</span>
<span class="sd">        For this sensitivity curve, you don&#39;t need to select the + or x polarization component since the detector is a triangle.</span>
<span class="sd">        The 60 degree abgle between detector arms is incoproated into the noise curve.</span>
<span class="sd">        The antenna pattern is incorporated in the noise curve.</span>
<span class="sd">        For SNRs, use an additional factor of sqrt(4) since BBO consists of 4 detectors!&quot;&quot;&quot;</span>
    
    <span class="c1"># White-dwarf confusion noise</span>
    <span class="n">SWD</span> <span class="o">=</span> <span class="mf">4.2e-47</span> <span class="o">*</span> <span class="n">f</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">7.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span><span class="o">/</span><span class="mf">5e-2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">fc</span> <span class="o">=</span> <span class="mf">7.69</span>
    <span class="n">S</span> <span class="o">=</span> <span class="mf">3.30</span> <span class="o">*</span> <span class="mf">1e-50</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">f</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mf">3.09</span><span class="o">*</span><span class="mf">1e-47</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">f</span><span class="o">/</span><span class="n">fc</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">SWD</span>
    <span class="k">return</span> <span class="n">S</span></div>


<div class="viewcode-block" id="SensitivityBBO"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.SensitivityBBO">[docs]</a><span class="k">def</span> <span class="nf">SensitivityBBO</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; From arXiv:1110.2865</span>
<span class="sd">        For this sensitivity curve, you don&#39;t need to select the + or x polarization component since the detector is a triangle.</span>
<span class="sd">        The 60 degree abgle between detector arms is incoproated into the noise curve.</span>
<span class="sd">        The antenna pattern is incorporated in the noise curve.</span>
<span class="sd">        For SNRs, use an additional factor of sqrt(4) since BBO consists of 4 detectors!&quot;&quot;&quot;</span>
    
    <span class="c1"># White-dwarf confusion noise</span>
    <span class="n">SWD</span> <span class="o">=</span> <span class="mf">4.2e-47</span> <span class="o">*</span> <span class="n">f</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">7.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span><span class="o">/</span><span class="mf">5e-2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">S</span> <span class="o">=</span> <span class="mf">6.15</span><span class="o">*</span><span class="mf">1e-51</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">f</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mf">1.95</span><span class="o">*</span><span class="mf">1e-48</span> <span class="o">+</span> <span class="mf">1.20</span><span class="o">*</span><span class="mf">1e-48</span><span class="o">*</span><span class="n">f</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">SWD</span>
    <span class="k">return</span> <span class="n">S</span></div>


    
<div class="viewcode-block" id="SNR"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.SNR">[docs]</a><span class="k">def</span> <span class="nf">SNR</span><span class="p">(</span><span class="n">fhSI</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">Sn</span><span class="p">,</span> <span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a reconstructed h in SI units in Fourier domain and distance d (in Mpc) this computes the SNR for sensitivity curve Sn&quot;&quot;&quot;</span>
    <span class="sd">&quot;&quot;&quot;Remember to select either h_+ or h_\cross! Otherise the SNR will be twice as large!&quot;&quot;&quot;</span>
    <span class="n">S</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">Sn</span><span class="p">,</span> <span class="n">fhSI</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="c1"># create table of values for noise curve</span>
    
    <span class="n">rho</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">fhSI</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fhSI</span><span class="o">.</span><span class="n">f</span><span class="o">/</span><span class="p">(</span><span class="n">d</span><span class="o">*</span><span class="n">Mpc</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">S</span><span class="p">)</span><span class="o">.</span><span class="n">Integrate</span><span class="p">(</span><span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rho</span></div>


<div class="viewcode-block" id="SNRavg"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.SNRavg">[docs]</a><span class="k">def</span> <span class="nf">SNRavg</span><span class="p">(</span><span class="n">fhSIModes</span><span class="p">,</span> <span class="n">lmax</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">Sn</span><span class="p">,</span> <span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a modes array in SI units in Fourier domain and distance d (in Mpc) this computes the angle averaged SNR for sensitivity curve Sn&quot;&quot;&quot;</span>
    <span class="n">S</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">Sn</span><span class="p">,</span> <span class="n">fhSIModes</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="c1"># create table of values for noise curve</span>
    
    <span class="n">rho</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">ll</span><span class="p">,</span> <span class="n">ll</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">rho</span> <span class="o">+=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">pi</span> <span class="o">*</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">fhSIModes</span><span class="p">[</span><span class="n">ll</span><span class="p">][</span><span class="n">mm</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fhSIModes</span><span class="p">[</span><span class="n">ll</span><span class="p">][</span><span class="n">mm</span><span class="p">]</span><span class="o">.</span><span class="n">f</span><span class="o">/</span><span class="p">(</span><span class="n">d</span><span class="o">*</span><span class="n">Mpc</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">S</span><span class="p">)</span><span class="o">.</span><span class="n">Integrate</span><span class="p">(</span><span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
    <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span></div>


<div class="viewcode-block" id="IntCharFreq"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.IntCharFreq">[docs]</a><span class="k">def</span> <span class="nf">IntCharFreq</span><span class="p">(</span><span class="n">fhSI</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">Sn</span><span class="p">,</span> <span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a reconstructed h in SI units in Fourier domain and distance d (in Mpc) this computes the integrated characteristic signal frequency for sensitivity curve Sn&quot;&quot;&quot;</span>
    <span class="sd">&quot;&quot;&quot;Remember to select either h_+ or h_\cross! Otherise the SNR will be twice as large!&quot;&quot;&quot;</span>
    <span class="n">S</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">Sn</span><span class="p">,</span> <span class="n">fhSI</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="c1"># create table of values for noise curve</span>
    
    <span class="n">fc</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">fhSI</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fhSI</span><span class="o">.</span><span class="n">f</span><span class="o">/</span><span class="p">(</span><span class="n">d</span><span class="o">*</span><span class="n">Mpc</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">fhSI</span><span class="o">.</span><span class="n">x</span><span class="o">/</span> <span class="n">S</span><span class="p">)</span><span class="o">.</span><span class="n">Integrate</span><span class="p">(</span><span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">/</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">fhSI</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fhSI</span><span class="o">.</span><span class="n">f</span><span class="o">/</span><span class="p">(</span><span class="n">d</span><span class="o">*</span><span class="n">Mpc</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">S</span><span class="p">)</span><span class="o">.</span><span class="n">Integrate</span><span class="p">(</span><span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
    <span class="k">return</span> <span class="n">fc</span></div>



<div class="viewcode-block" id="WienerScalarProduct"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.WienerScalarProduct">[docs]</a><span class="k">def</span> <span class="nf">WienerScalarProduct</span><span class="p">(</span><span class="n">hSI1</span><span class="p">,</span> <span class="n">hSI2</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">Sn</span><span class="p">,</span> <span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a reconstructed h1 and h2 in SI units in Fourier domain and distance d (in Mpc) this computes the Wiener scalar product for sensitivity curve Sn&quot;&quot;&quot;</span>
    <span class="n">S</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">Sn</span><span class="p">,</span> <span class="n">hSI1</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="c1"># create table of values for noise curve</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">hSI1</span><span class="o">.</span><span class="n">x</span> <span class="o">!=</span> <span class="n">hSI2</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">hSI1</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hSI2</span><span class="o">.</span><span class="n">x</span><span class="p">)):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Waveforms are not stored at same frequencies!&quot;</span><span class="p">)</span>
    
    <span class="n">prod</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">hSI1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">hSI1</span><span class="o">.</span><span class="n">f</span><span class="o">/</span><span class="p">(</span><span class="n">d</span><span class="o">*</span><span class="n">Mpc</span><span class="p">)</span><span class="o">*</span><span class="n">hSI2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">conjugate</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">d</span><span class="o">*</span><span class="n">Mpc</span><span class="p">)</span> <span class="o">/</span> <span class="n">S</span><span class="p">)</span><span class="o">.</span><span class="n">Integrate</span><span class="p">(</span><span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
    
    <span class="k">return</span> <span class="n">prod</span></div>

<div class="viewcode-block" id="WienerDiscreteScalarProduct"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.WienerDiscreteScalarProduct">[docs]</a><span class="k">def</span> <span class="nf">WienerDiscreteScalarProduct</span><span class="p">(</span><span class="n">hSI1</span><span class="p">,</span> <span class="n">hSI2</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">Sn</span><span class="p">,</span> <span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a reconstructed h1 and h2 in SI units in Fourier domain and distance d (in Mpc) this computes the discrete Wiener scalar product for sensitivity curve Sn&quot;&quot;&quot;</span>
    <span class="n">S</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">Sn</span><span class="p">,</span> <span class="n">hSI1</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="c1"># create table of values for noise curve</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">hSI1</span><span class="o">.</span><span class="n">x</span> <span class="o">!=</span> <span class="n">hSI2</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">hSI1</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hSI2</span><span class="o">.</span><span class="n">x</span><span class="p">)):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Waveforms are not stored at same frequencies!&quot;</span><span class="p">)</span>
    
    <span class="n">s</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">WaveFunction</span><span class="p">(</span><span class="n">hSI1</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">hSI1</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">/</span><span class="p">(</span><span class="n">d</span><span class="o">*</span><span class="n">Mpc</span><span class="p">)</span><span class="o">*</span><span class="n">hSI2</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">conjugate</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">d</span><span class="o">*</span><span class="n">Mpc</span><span class="p">)</span> <span class="o">/</span> <span class="n">S</span><span class="p">)</span><span class="o">.</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>  <span class="c1">#.Integrate(fLow, fHi, False).real</span>
    <span class="n">prod</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">hSI1</span><span class="o">.</span><span class="n">x</span><span class="p">))</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">hSI1</span><span class="o">.</span><span class="n">x</span><span class="p">)))</span> <span class="o">*</span> <span class="n">s</span><span class="o">/</span><span class="n">hSI1</span><span class="o">.</span><span class="n">Length</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">prod</span></div>


<div class="viewcode-block" id="OrthonormalBasis"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.OrthonormalBasis">[docs]</a><span class="k">def</span> <span class="nf">OrthonormalBasis</span><span class="p">(</span><span class="n">hSI_plus</span><span class="p">,</span> <span class="n">hSI_cross</span><span class="p">,</span> <span class="n">Sn</span><span class="p">,</span> <span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given the two linearly independent waves h_plus and h_cross in SI units and in the Fourier domain, we find an orthonormalised basis wrt to the detector inner product&quot;&quot;&quot;</span>
    <span class="c1"># set scalar product</span>
    <span class="n">ScalProd</span> <span class="o">=</span> <span class="n">WienerDiscreteScalarProduct</span>   <span class="c1"># Use discrete product for now. The continuous product yields the same answer to high precision</span>
    
    <span class="n">norm_plus</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">ScalProd</span><span class="p">(</span><span class="n">hSI_plus</span><span class="p">,</span> <span class="n">hSI_plus</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Sn</span><span class="p">,</span> <span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">))</span>
    <span class="n">norm_cross</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">ScalProd</span><span class="p">(</span><span class="n">hSI_cross</span><span class="p">,</span> <span class="n">hSI_cross</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Sn</span><span class="p">,</span> <span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">))</span>
    
    <span class="c1"># prevent NANs</span>
    <span class="k">if</span> <span class="n">norm_plus</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">norm_plus</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">if</span> <span class="n">norm_cross</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">norm_cross</span> <span class="o">=</span> <span class="mf">1.0</span>
    
    <span class="c1"># First vector is simply the nomralised h_+ </span>
    <span class="n">e_plus</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">hSI_plus</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">hSI_plus</span><span class="o">.</span><span class="n">f</span><span class="o">/</span><span class="n">norm_plus</span><span class="p">)</span>
    <span class="c1"># Normalise cross mode as well</span>
    <span class="n">e_cross</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">hSI_cross</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">hSI_cross</span><span class="o">.</span><span class="n">f</span><span class="o">/</span><span class="n">norm_cross</span><span class="p">)</span>
    <span class="c1"># Get orthonormal e_ortho that is orthonormal to e_plus</span>
    <span class="n">e_ortho</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">e_cross</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">e_cross</span><span class="o">.</span><span class="n">f</span> <span class="o">-</span> <span class="n">e_plus</span><span class="o">.</span><span class="n">f</span><span class="o">*</span><span class="n">ScalProd</span><span class="p">(</span><span class="n">e_plus</span><span class="p">,</span> <span class="n">e_cross</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Sn</span><span class="p">,</span> <span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">)</span>
              <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">ScalProd</span><span class="p">(</span><span class="n">e_plus</span><span class="p">,</span> <span class="n">e_cross</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Sn</span><span class="p">,</span> <span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1">#print(&quot;&lt;e_plus, e_ortho&gt; = {0}&quot;.fornat(ScalProd(e_plus, e_ortho, 1, Sn, fLow, fHi)))</span>
    <span class="c1">#print(&quot;&lt;e_plus, e_plus&gt; = {0}&quot;.format(ScalProd(e_plus, e_plus, 1, Sn, fLow, fHi)))</span>
    <span class="c1">#print(&quot;&lt;e_cross, e_cross&gt; = {0}&quot;.format(ScalProd(e_cross, e_cross, 1, Sn, fLow, fHi)))</span>
    
    <span class="k">return</span> <span class="n">e_plus</span><span class="p">,</span> <span class="n">e_ortho</span></div>

<div class="viewcode-block" id="CorrelationFunction"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.CorrelationFunction">[docs]</a><span class="k">def</span> <span class="nf">CorrelationFunction</span><span class="p">(</span><span class="n">fhSI1</span><span class="p">,</span> <span class="n">fhSI2</span><span class="p">,</span> <span class="n">Sn</span><span class="p">,</span> <span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computes the correlation function over a given detector by using Fourier-modes in SI units.</span>
<span class="sd">       The definition of the correlation function is given in Phys. Rev. D 44, 3819-3834, Eq. 2.6, and especially Eq. 2.8 in terms of Fourier transforms.&quot;&quot;&quot;</span>
    
    <span class="n">S</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">Sn</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fhSI1</span><span class="o">.</span><span class="n">x</span><span class="p">))</span> <span class="c1"># create table of values for noise curve</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="n">norm1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">WaveFunction</span><span class="p">(</span><span class="n">fhSI1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">fhSI1</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="n">fhSI1</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">conjugate</span><span class="p">()</span> <span class="o">/</span> <span class="n">S</span><span class="p">)</span><span class="o">.</span><span class="n">InverseFourierTransform</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
    <span class="n">norm2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">WaveFunction</span><span class="p">(</span><span class="n">fhSI2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">fhSI2</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="n">fhSI2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">conjugate</span><span class="p">()</span> <span class="o">/</span> <span class="n">S</span><span class="p">)</span><span class="o">.</span><span class="n">InverseFourierTransform</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
    
    <span class="c1"># Prevent NANs</span>
    <span class="k">if</span> <span class="n">norm1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">norm1</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">if</span> <span class="n">norm2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">norm2</span> <span class="o">=</span> <span class="mf">1.0</span>
    
    <span class="n">C</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="p">(</span><span class="n">fhSI1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">fhSI1</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="n">fhSI2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">conjugate</span><span class="p">()</span> <span class="o">/</span> <span class="n">S</span><span class="p">)</span><span class="o">.</span><span class="n">InverseFourierTransform</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">C</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">real</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">norm1</span><span class="o">*</span><span class="n">norm2</span><span class="p">)</span>
    <span class="c1">#C.f[0] = 0 # get rid of zero-freq component</span>
    <span class="k">return</span> <span class="n">C</span></div>

<div class="viewcode-block" id="Match"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.Match">[docs]</a><span class="k">def</span> <span class="nf">Match</span><span class="p">(</span><span class="n">hSI1</span><span class="p">,</span> <span class="n">hSI2</span><span class="p">,</span> <span class="n">Sn</span><span class="p">,</span> <span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">,</span> <span class="n">WFtype</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computes the best match given two waveforms hSI1 and hSI2 in SI units in the time domain.</span>
<span class="sd">    The waveforms are assumed to be in the standard from h=h_+-ih_x.</span>
<span class="sd">    If WFtype is not set to &#39;h&#39;, but &#39;psi4&#39; or &#39;news&#39; we will perform the integration in the Fourier domain to get h&quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">hSI1</span><span class="o">.</span><span class="n">x</span> <span class="o">!=</span> <span class="n">hSI2</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">hSI1</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hSI2</span><span class="o">.</span><span class="n">x</span><span class="p">)):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Inconsistent waveforms. Interpolate to same gridpoints!&quot;</span><span class="p">)</span>
    
    <span class="n">hSI1plus</span> <span class="o">=</span> <span class="n">SelecthPlus</span><span class="p">(</span><span class="n">hSI1</span><span class="p">)</span>
    <span class="n">hSI1cross</span> <span class="o">=</span> <span class="n">SelecthCross</span><span class="p">(</span><span class="n">hSI1</span><span class="p">)</span>
    <span class="n">hSI2plus</span> <span class="o">=</span> <span class="n">SelecthPlus</span><span class="p">(</span><span class="n">hSI2</span><span class="p">)</span>
    <span class="n">hSI2cross</span> <span class="o">=</span> <span class="n">SelecthCross</span><span class="p">(</span><span class="n">hSI2</span><span class="p">)</span>
    
    <span class="n">fhSI1plus</span> <span class="o">=</span> <span class="n">hSI1plus</span><span class="o">.</span><span class="n">FourierTransform</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fhSI1cross</span> <span class="o">=</span> <span class="n">hSI1cross</span><span class="o">.</span><span class="n">FourierTransform</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fhSI2plus</span> <span class="o">=</span> <span class="n">hSI2plus</span><span class="o">.</span><span class="n">FourierTransform</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fhSI2cross</span> <span class="o">=</span> <span class="n">hSI2cross</span><span class="o">.</span><span class="n">FourierTransform</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># restrict to requested frequency range</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fhSI1plus</span><span class="o">.</span><span class="n">Length</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">fhSI1plus</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">fLow</span> <span class="ow">or</span> <span class="n">fhSI1plus</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">fHi</span><span class="p">:</span> 
            <span class="n">fhSI1plus</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">fhSI1cross</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">fhSI2plus</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">fhSI2cross</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    
    <span class="c1"># user has not provided h but psi4 in SI units.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">WFtype</span> <span class="o">==</span> <span class="s1">&#39;psi4&#39;</span><span class="p">):</span>
        <span class="n">fhSI1plus</span> <span class="o">=</span> <span class="n">GethFD</span><span class="p">(</span><span class="n">fhSI1plus</span><span class="p">,</span> <span class="s1">&#39;psi4&#39;</span><span class="p">)</span>
        <span class="n">fhSI1cross</span> <span class="o">=</span> <span class="n">GethFD</span><span class="p">(</span><span class="n">fhSI1cross</span><span class="p">,</span> <span class="s1">&#39;psi4&#39;</span><span class="p">)</span>
        <span class="n">fhSI2plus</span> <span class="o">=</span> <span class="n">GethFD</span><span class="p">(</span><span class="n">fhSI2plus</span><span class="p">,</span> <span class="s1">&#39;psi4&#39;</span><span class="p">)</span>
        <span class="n">fhSI2cross</span> <span class="o">=</span> <span class="n">GethFD</span><span class="p">(</span><span class="n">fhSI2cross</span><span class="p">,</span> <span class="s1">&#39;psi4&#39;</span><span class="p">)</span>
    <span class="c1"># user has not provided h but news in SI units.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">WFtype</span> <span class="o">==</span> <span class="s1">&#39;news&#39;</span><span class="p">):</span>
        <span class="n">fhSI1plus</span> <span class="o">=</span> <span class="n">GethFD</span><span class="p">(</span><span class="n">fhSI1plus</span><span class="p">,</span> <span class="s1">&#39;news&#39;</span><span class="p">)</span>
        <span class="n">fhSI1cross</span> <span class="o">=</span> <span class="n">GethFD</span><span class="p">(</span><span class="n">fhSI1cross</span><span class="p">,</span> <span class="s1">&#39;news&#39;</span><span class="p">)</span>
        <span class="n">fhSI2plus</span> <span class="o">=</span> <span class="n">GethFD</span><span class="p">(</span><span class="n">fhSI2plus</span><span class="p">,</span> <span class="s1">&#39;news&#39;</span><span class="p">)</span>
        <span class="n">fhSI2cross</span> <span class="o">=</span> <span class="n">GethFD</span><span class="p">(</span><span class="n">fhSI2cross</span><span class="p">,</span> <span class="s1">&#39;news&#39;</span><span class="p">)</span>
    
    <span class="n">e1_plus</span><span class="p">,</span> <span class="n">e1_ortho</span> <span class="o">=</span> <span class="n">OrthonormalBasis</span><span class="p">(</span><span class="n">fhSI1plus</span><span class="p">,</span> <span class="n">fhSI1cross</span><span class="p">,</span> <span class="n">Sn</span><span class="p">,</span> <span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">)</span>
    <span class="n">e2_plus</span><span class="p">,</span> <span class="n">e2_ortho</span> <span class="o">=</span> <span class="n">OrthonormalBasis</span><span class="p">(</span><span class="n">fhSI2plus</span><span class="p">,</span> <span class="n">fhSI2cross</span><span class="p">,</span> <span class="n">Sn</span><span class="p">,</span> <span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">)</span>
    
    <span class="c1"># We compute the correlation function in order to maximize over time-lag between the two given waveforms.</span>
    <span class="n">p1p2p</span> <span class="o">=</span> <span class="n">CorrelationFunction</span><span class="p">(</span><span class="n">e1_plus</span><span class="p">,</span> <span class="n">e2_plus</span><span class="p">,</span> <span class="n">Sn</span><span class="p">,</span> <span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">)</span>
    <span class="n">p1p2n</span> <span class="o">=</span> <span class="n">CorrelationFunction</span><span class="p">(</span><span class="n">e1_plus</span><span class="p">,</span> <span class="n">e2_ortho</span><span class="p">,</span> <span class="n">Sn</span><span class="p">,</span> <span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">)</span>
    
    <span class="n">p1n2p</span> <span class="o">=</span> <span class="n">CorrelationFunction</span><span class="p">(</span><span class="n">e1_ortho</span><span class="p">,</span> <span class="n">e2_plus</span><span class="p">,</span> <span class="n">Sn</span><span class="p">,</span> <span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">)</span>
    <span class="n">p1n2n</span> <span class="o">=</span> <span class="n">CorrelationFunction</span><span class="p">(</span><span class="n">e1_ortho</span><span class="p">,</span> <span class="n">e2_ortho</span><span class="p">,</span> <span class="n">Sn</span><span class="p">,</span> <span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">)</span>
    
    <span class="n">A</span> <span class="o">=</span> <span class="n">p1p2p</span><span class="o">.</span><span class="n">f</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">p1p2n</span><span class="o">.</span><span class="n">f</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">p1n2p</span><span class="o">.</span><span class="n">f</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">p1n2n</span><span class="o">.</span><span class="n">f</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">p1p2p</span><span class="o">.</span><span class="n">f</span><span class="o">*</span><span class="n">p1n2p</span><span class="o">.</span><span class="n">f</span> <span class="o">+</span> <span class="n">p1p2n</span><span class="o">.</span><span class="n">f</span><span class="o">*</span><span class="n">p1n2n</span><span class="o">.</span><span class="n">f</span>
    
    <span class="c1">#A = WienerScalarProduct(e1_plus, e2_plus, 1, Sn, fLow, fHi)**2 + WienerScalarProduct(e1_plus, e2_ortho, 1, Sn, fLow, fHi)**2</span>
    <span class="c1">#B = WienerScalarProduct(e1_ortho, e2_plus, 1, Sn, fLow, fHi)**2 + WienerScalarProduct(e1_ortho, e2_ortho, 1, Sn, fLow, fHi)**2</span>
    <span class="c1">#C = WienerScalarProduct(e1_plus, e2_plus, 1, Sn, fLow, fHi) * WienerScalarProduct(e1_ortho, e2_plus, 1, Sn, fLow, fHi) </span>
    <span class="c1">#    + WienerScalarProduct(e1_plus, e2_ortho, 1, Sn, fLow, fHi) * WienerScalarProduct(e1_ortho, e2_ortho, 1, Sn, fLow, fHi)</span>
    
    
    <span class="n">best</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">A</span><span class="o">+</span><span class="n">B</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span> <span class="n">sqrt</span><span class="p">(((</span><span class="n">A</span><span class="o">-</span><span class="n">B</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">C</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">))</span>
    <span class="n">minmax</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">A</span><span class="o">+</span><span class="n">B</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span> <span class="n">sqrt</span><span class="p">(((</span><span class="n">A</span><span class="o">-</span><span class="n">B</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">C</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">))</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">best</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">minmax</span><span class="p">)</span>  <span class="c1"># pick max value according to correlation.</span></div>


<div class="viewcode-block" id="MisMatch"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.MisMatch">[docs]</a><span class="k">def</span> <span class="nf">MisMatch</span><span class="p">(</span><span class="n">hSI1</span><span class="p">,</span> <span class="n">hSI2</span><span class="p">,</span> <span class="n">Sn</span><span class="p">,</span> <span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">,</span> <span class="n">WFtype</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Same as above but 1-Match&quot;&quot;&quot;</span>
    <span class="n">best</span><span class="p">,</span> <span class="n">minmax</span> <span class="o">=</span> <span class="n">Match</span><span class="p">(</span><span class="n">hSI1</span><span class="p">,</span> <span class="n">hSI2</span><span class="p">,</span> <span class="n">Sn</span><span class="p">,</span> <span class="n">fLow</span><span class="p">,</span> <span class="n">fHi</span><span class="p">,</span> <span class="n">WFtype</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span><span class="o">-</span><span class="n">best</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">minmax</span></div>



<div class="viewcode-block" id="Richardson_error"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.Richardson_error">[docs]</a><span class="k">def</span> <span class="nf">Richardson_error</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">dxLow</span><span class="p">,</span> <span class="n">dxHi</span><span class="p">,</span> <span class="n">errorDF</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Richardson extrapolates the errorDF assumed as given by the difference on low dxLow and hi resolution dxHi by the order specified.&quot;&quot;&quot;</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">DiscreteFunction</span><span class="p">(</span><span class="n">errorDF</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">((</span><span class="n">dxLow</span><span class="o">/</span><span class="n">dxHi</span><span class="p">)</span><span class="o">**</span><span class="n">order</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">errorDF</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">err</span></div>


<div class="viewcode-block" id="PhaseAlignOverRange"><a class="viewcode-back" href="../../../../API/CactusTool.Lib.pygwanalysis.html#CactusTool.Lib.pygwanalysis.DataAnalysis.PhaseAlignOverRange">[docs]</a><span class="k">def</span> <span class="nf">PhaseAlignOverRange</span><span class="p">(</span><span class="n">DF1</span><span class="p">,</span> <span class="n">DF2</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">start_xoff</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">accuracy</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span> <span class="n">monotonic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Phase-aligns two waveforms by minimizing their difference in the L2 norm and </span>
<span class="sd">       returns the time-shift (and phase shift) that needs to be applied. The procedure is that</span>
<span class="sd">       from Boyle et al, arxiv:0804.4184v2.</span>
<span class="sd">       DF1: phase of waveform 1</span>
<span class="sd">       DF2: phase of waveform 2</span>
<span class="sd">       [x0,x1]: The minimization interval.</span>
<span class="sd">       start_xoff: An initial guess to speed up computation.</span>
<span class="sd">       delta: the shift will be applied in the range [start_xoff-delta, start_xoff+delta]. </span>
<span class="sd">              The smaller delta, the faster (but keep in mind that you need to be sure that the minimum is located in that range!</span>
<span class="sd">       dx: The delta spacing of interpolated function values on which the pointwise difference is taken.</span>
<span class="sd">       accuracy: The accuracy in finding the shift that minimizes the L2 norm of the error (&#39;the delta spacing of the shift&#39;).</span>
<span class="sd">       monotonic: Set to &#39;True&#39; if function is monotonic (this will greatly speed up computation)&quot;&quot;&quot;</span>

    <span class="c1"># Note: this function is essentially identical to AlignOverRange in DiscreteFunction.py.</span>
    <span class="c1">#       But this also return a phase shift!</span>

    <span class="c1"># Keep DF1 fixed. Find offset x_off that needs to be applied to DF2.x</span>
    <span class="c1"># in order to make the L2-norm of the difference over a range [x0,x1]</span>
    <span class="c1"># as small as possible.</span>

    <span class="n">x_off</span> <span class="o">=</span> <span class="n">start_xoff</span><span class="o">-</span><span class="n">delta</span>
    <span class="n">minErr</span> <span class="o">=</span> <span class="mf">10e10</span>
    <span class="n">minX</span> <span class="o">=</span> <span class="n">x_off</span>
    <span class="n">trueMinX</span> <span class="o">=</span> <span class="n">x_off</span>
    <span class="n">trueDeltaPhi</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">firstTime</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># If function is monotonic, we can use a faster algorithm</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">monotonic</span><span class="o">==</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">delta</span><span class="o">/</span><span class="n">accuracy</span><span class="o">*</span><span class="mf">0.1</span>
        <span class="n">maxX</span> <span class="o">=</span> <span class="n">start_xoff</span><span class="o">+</span><span class="n">delta</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">factor</span> <span class="o">&gt;=</span> <span class="mf">1.0</span> <span class="ow">or</span> <span class="n">firstTime</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">x_off</span> <span class="o">=</span> <span class="n">minX</span>
            <span class="n">minErr</span> <span class="o">=</span> <span class="mf">10e10</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">x_off</span> <span class="o">&lt;</span> <span class="n">maxX</span><span class="p">):</span>
                <span class="n">DF2shift</span> <span class="o">=</span> <span class="n">DiscreteFunction</span><span class="p">(</span><span class="n">DF2</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="n">x_off</span><span class="p">,</span> <span class="n">DF2</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
                <span class="n">subDF1</span><span class="p">,</span> <span class="n">subDF2</span> <span class="o">=</span> <span class="n">MakeConsistent</span><span class="p">(</span><span class="n">DF1</span><span class="p">,</span> <span class="n">DF2shift</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
                <span class="c1"># first, compute DeltaPhi analytically according to Boyle et al. via midpoint rule</span>
                <span class="n">DeltaPhi</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">DeltaPhi</span> <span class="o">+=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">subDF1</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">subDF2</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">DeltaPhi</span> <span class="o">+=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">subDF1</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">subDF2</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">subDF1</span><span class="o">.</span><span class="n">Length</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">DeltaPhi</span> <span class="o">+=</span> <span class="p">(</span><span class="n">subDF1</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">subDF2</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                <span class="n">DeltaPhi</span> <span class="o">/=</span> <span class="p">(</span><span class="n">subDF1</span><span class="o">.</span><span class="n">Length</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1"># Now compute error</span>
                <span class="n">err</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">subDF1</span><span class="o">.</span><span class="n">Length</span><span class="p">()):</span>
                    <span class="n">err</span> <span class="o">+=</span> <span class="p">(</span><span class="n">subDF1</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">subDF2</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">DeltaPhi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
                <span class="c1">#err = sqrt(err)  # sqrt not necessary</span>
                <span class="c1">#print(minErr, err)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="n">minErr</span><span class="p">):</span>
                    <span class="n">minErr</span> <span class="o">=</span> <span class="n">err</span>
                    <span class="n">minX</span> <span class="o">=</span> <span class="n">x_off</span><span class="o">-</span><span class="n">accuracy</span><span class="o">*</span><span class="n">factor</span>
                    <span class="n">trueMinX</span> <span class="o">=</span> <span class="n">x_off</span>
                    <span class="n">trueDeltaPhi</span> <span class="o">=</span> <span class="n">DeltaPhi</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">maxX</span> <span class="o">=</span> <span class="n">x_off</span>
                    <span class="k">break</span>
                <span class="n">x_off</span> <span class="o">+=</span> <span class="n">accuracy</span><span class="o">*</span><span class="n">factor</span>
            <span class="n">factor</span> <span class="o">*=</span> <span class="mf">0.1</span>
            <span class="n">firstTime</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1">#print(factor)</span>
        <span class="k">return</span> <span class="n">trueMinX</span><span class="p">,</span> <span class="n">trueDeltaPhi</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR! ...using brute force method!&quot;</span><span class="p">)</span>
    
    <span class="c1"># Proceed with brute force algorithm...</span>

    <span class="n">x_off</span> <span class="o">=</span> <span class="n">start_xoff</span><span class="o">-</span><span class="n">delta</span>

    <span class="n">minErr</span> <span class="o">=</span> <span class="mf">10e10</span>
    <span class="n">minX</span> <span class="o">=</span> <span class="n">x_off</span>
    <span class="n">minDeltaPhi</span> <span class="o">=</span> <span class="mi">0</span>


    <span class="c1"># We shift DF2 and compute the error over range [x0,x1]</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">x_off</span> <span class="o">&lt;</span> <span class="n">start_xoff</span><span class="o">+</span><span class="n">delta</span><span class="p">):</span>
        <span class="n">DF2shift</span> <span class="o">=</span> <span class="n">DiscreteFunction</span><span class="p">(</span><span class="n">DF2</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="n">x_off</span><span class="p">,</span> <span class="n">DF2</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        <span class="n">subDF1</span><span class="p">,</span> <span class="n">subDF2</span> <span class="o">=</span> <span class="n">MakeConsistent</span><span class="p">(</span><span class="n">DF1</span><span class="p">,</span> <span class="n">DF2shift</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="c1"># first, compute DeltaPhi analytically according to Boyle et al.</span>
        <span class="n">DeltaPhi</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">DeltaPhi</span> <span class="o">+=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">subDF1</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">subDF2</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">DeltaPhi</span> <span class="o">+=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">subDF1</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">subDF2</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">subDF1</span><span class="o">.</span><span class="n">Length</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">DeltaPhi</span> <span class="o">+=</span> <span class="p">(</span><span class="n">subDF1</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">subDF2</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
        <span class="n">DeltaPhi</span> <span class="o">/=</span> <span class="p">(</span><span class="n">subDF1</span><span class="o">.</span><span class="n">Length</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">err</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">subDF1</span><span class="o">.</span><span class="n">Length</span><span class="p">()):</span>
            <span class="n">err</span> <span class="o">+=</span> <span class="p">(</span><span class="n">subDF1</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">subDF2</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">DeltaPhi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="c1">#err = sqrt(err) # sqrt not necessary</span>
        <span class="c1">#print(err)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="n">minErr</span><span class="p">):</span>
            <span class="n">minErr</span> <span class="o">=</span> <span class="n">err</span>
            <span class="n">minX</span> <span class="o">=</span> <span class="n">x_off</span>
            <span class="n">minDeltaPhi</span> <span class="o">=</span> <span class="n">DeltaPhi</span>
        <span class="n">x_off</span> <span class="o">+=</span> <span class="n">accuracy</span>

    <span class="k">return</span> <span class="n">minX</span><span class="p">,</span> <span class="n">minDeltaPhi</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">CactusTool 0.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Yu Liu.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.0.
    </div>
  </body>
</html>